<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>SSE Query Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
        }
        #queryForm {
            display: flex;
            margin-bottom: 20px;
        }
        #promptInput {
            flex-grow: 1;
            padding: 10px;
            margin-right: 10px;
        }
        #submitButton {
            padding: 10px 20px;
        }
        #output {
            border: 1px solid #ddd;
            padding: 10px;
            min-height: 200px;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>Server-Sent Events (SSE) Query Test</h1>
    
    <form id="queryForm">
        <input 
            type="text" 
            id="promptInput" 
            placeholder="Enter your query" 
            required
        >
        <button 
            type="submit" 
            id="submitButton"
        >
            Send Query
        </button>
    </form>

    <div id="output"></div>

    <script>
        document.getElementById('queryForm').addEventListener('submit', function(event) {
        event.preventDefault();
        
        const prompt = document.getElementById('promptInput').value;
        const outputDiv = document.getElementById('output');
        outputDiv.textContent = ''; // Clear previous output

        fetch('http://localhost:8000/manual', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'text/event-stream'
            },
            body: JSON.stringify({ "question": prompt, "session_id":"" })
        })
        .then(response => {
            if (!response.ok) {
                throw new Error('Network response was not ok');
            }
            const reader = response.body.getReader();
            const decoder = new TextDecoder('utf-8');

            function read() {
                reader.read().then(({ done, value }) => {
                    if (done) {
                        return;
                    }

                    const chunk = decoder.decode(value, { stream: true });
                    const lines = chunk.split('\n');
                    lines.forEach(line => {
                        if (line.trim()) {
                            const parsedLine = JSON.parse(line);
                            const status = parsedLine.status;
                            const data = parsedLine.data;
                            
                            // Console logging
                            console.log(`[${status}] ${data}`);
                            
                            // Update output div (keep text in a single line)
                            outputDiv.textContent += data;
                        }
                    });
                    
                    read();
                });
            }

            read();
        })
        .catch(error => {
            console.error('Fetch error:', error);
            outputDiv.textContent = `Error: ${error.message}`;
        });
    });

    </script>
</body>
</html>
